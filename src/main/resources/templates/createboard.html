<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>게시글 작성</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body class="bg-light">
<div class="container mt-5">
    <div class="card shadow-sm mx-auto" style="max-width: 700px;">
        <div class="card-body">
            <h2 class="card-title text-center mb-4">게시글 작성</h2>

            <form id="board-form">
                <div class="mb-3">
                    <label for="title" class="form-label">제목</label>
                    <input type="text" class="form-control" id="title" placeholder="게시글 제목 입력" required>
                </div>
                <div class="mb-3">
                    <label for="description" class="form-label">설명</label>
                    <textarea class="form-control" id="description" rows="4" placeholder="내용 입력" required></textarea>
                </div>
                <div class="mb-3">
                    <label for="category" class="form-label">카테고리</label>
                    <select class="form-select" id="category" required>
                        <option value="">선택하세요</option>
                        <option value="DESIGN">디자인</option>
                        <option value="DEVELOPMENT">개발</option>
                        <option value="PLANNING">기획</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="credit_price" class="form-label">크레딧 가격</label>
                    <input type="number" class="form-control" id="credit_price" placeholder="예: 5" min="0" required>
                </div>

                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" id="is_closed">
                    <label class="form-check-label" for="is_closed">모집 마감</label>
                </div>

                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    <button type="button" class="btn btn-secondary" onclick="goBack()">뒤로가기</button>
                    <button type="submit" class="btn btn-primary">작성</button>
                </div>
            </form>

            <div id="message" class="mt-3"></div>
        </div>
    </div>
</div>

<script>
    const token = localStorage.getItem('accessToken');

    document.getElementById('board-form').addEventListener('submit', async function (e) {
        e.preventDefault();

        const boardData = {
            title: document.getElementById('title').value,
            description: document.getElementById('description').value,
            category: document.getElementById('category').value,
            credit_price: parseInt(document.getElementById('credit_price').value),
            is_closed: document.getElementById('is_closed').checked,
            like_count: 0
        };

        try {
            const res = await axios.post('/api/boards', boardData, {
                headers: {
                    'Content-Type': 'application/json',
                    // 'Authorization': `${token}`
                    'Authorization': `${token}`
                }
            });

            document.getElementById('message').innerHTML =
                `<div class="alert alert-success">게시글이 성공적으로 등록되었습니다.</div>`;
            document.getElementById('board-form').reset();
        } catch (err) {
            document.getElementById('message').innerHTML =
                `<div class="alert alert-danger">게시글 등록에 실패했습니다.</div>`;
        }
    });

    function goBack() {
        window.location.href = '/boardpage';
    }
</script>
</body>
</html>